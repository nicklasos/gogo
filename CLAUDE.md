# Claude Project Memory

## ğŸ—ï¸ Architecture

### Core Philosophy
- **Clean separation of concerns** with clear layer responsibilities
- **Simplicity over complexity** - avoid unnecessary abstractions
- **Type-safe database operations** using sqlc
- **Environment-driven configuration** - no hardcoded secrets

### Directory Structure
```
myapp/
â”œâ”€â”€ cmd/api/main.go              # Main application entry
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ db/db.go                 # Database connection
â”‚   â””â”€â”€ users/                   # Domain modules
â”‚       â”œâ”€â”€ handler.go           # HTTP controllers
â”‚       â”œâ”€â”€ user_service.go      # Business logic
â”‚       â”œâ”€â”€ queries.sql          # SQL queries
â”‚       â”œâ”€â”€ queries_gen.go       # Generated sqlc code
â”‚       â””â”€â”€ routes.go            # Route registration
â”œâ”€â”€ migrations/                  # Goose database migrations
â””â”€â”€ Makefile                     # Development commands
```

### Request Flow
```
HTTP Request â†’ Handler â†’ Service â†’ sqlc â†’ Database
```

### Layer Responsibilities
- **Handlers**: HTTP request/response, basic validation, JSON serialization
- **Services**: Business logic, input validation, complex workflows, uses sqlc directly
- **Queries**: SQL queries managed by sqlc, type-safe database operations

## ğŸ”§ Technology Stack
- **Go 1.23+** - Programming language
- **Echo v4** - Web framework
- **PostgreSQL 13+** - Database
- **pgx/v5** - PostgreSQL driver
- **sqlc** - Type-safe SQL code generation
- **Goose** - Database migrations
- **Swaggo** - Swagger documentation

## ğŸ“ Module Pattern
When adding new modules (orders, products, etc.):

```go
// internal/orders/
â”œâ”€â”€ handler.go           # HTTP endpoints
â”œâ”€â”€ order_service.go     # Business logic
â”œâ”€â”€ queries.sql          # SQL queries
â”œâ”€â”€ queries_gen.go       # Generated by sqlc
â””â”€â”€ routes.go           # Route registration
```

## ğŸ—„ï¸ Database Management
```bash
# Create migration
make migrate-create

# Apply migrations
export DATABASE_URL="your_connection_string"
make migrate-up

# Generate sqlc after schema changes
make sqlc
```

## ğŸš€ Development Commands
```bash
# Development
make run              # Start server
make build            # Build binary
make test             # Run tests
make fmt              # Format code

# Database
make migrate-up       # Apply migrations
make sqlc            # Generate sqlc code
make swagger         # Generate API docs
```

## ğŸ“‹ Code Conventions
- **Handlers**: `GetUser`, `CreateUser`, `ListUsers`
- **Services**: `UserService`, `OrderService`
- **SQL queries**: `GetUserByID`, `CreateUser`, `ListUsers`
- **Files**: `user_service.go`, `order_handler.go`

## ğŸ¯ Key Principles
1. **Services own business logic** - Keep handlers thin
2. **Use sqlc directly** - No repository abstraction
3. **Environment-driven config** - No hardcoded values
4. **Module-based organization** - Self-contained domains

## ğŸš« What We DON'T Use
- NO Repository Pattern - Services use sqlc directly
- NO ORM - Raw SQL with sqlc for type safety
- NO complex abstractions - Keep it simple