# Claude Project Memory

## 🏗️ Architecture

### Core Philosophy
- **Clean separation of concerns** with clear layer responsibilities
- **Simplicity over complexity** - avoid unnecessary abstractions
- **Type-safe database operations** using sqlc
- **Environment-driven configuration** - no hardcoded secrets

### Directory Structure
```
myapp/
├── cmd/api/main.go              # Main application entry
├── internal/
│   ├── db/db.go                 # Database connection
│   └── users/                   # Domain modules
│       ├── handler.go           # HTTP controllers
│       ├── user_service.go      # Business logic
│       ├── queries.sql          # SQL queries
│       ├── queries_gen.go       # Generated sqlc code
│       └── routes.go            # Route registration
├── migrations/                  # Goose database migrations
└── Makefile                     # Development commands
```

### Request Flow
```
HTTP Request → Handler → Service → sqlc → Database
```

### Layer Responsibilities
- **Handlers**: HTTP request/response, basic validation, JSON serialization
- **Services**: Business logic, input validation, complex workflows, uses sqlc directly
- **Queries**: SQL queries managed by sqlc, type-safe database operations

## 🔧 Technology Stack
- **Go 1.23+** - Programming language
- **Echo v4** - Web framework
- **PostgreSQL 13+** - Database
- **pgx/v5** - PostgreSQL driver
- **sqlc** - Type-safe SQL code generation
- **Goose** - Database migrations
- **Swaggo** - Swagger documentation

## 📁 Module Pattern
When adding new modules (orders, products, etc.):

```go
// internal/orders/
├── handler.go           # HTTP endpoints
├── order_service.go     # Business logic
├── queries.sql          # SQL queries
├── queries_gen.go       # Generated by sqlc
└── routes.go           # Route registration
```

## 🗄️ Database Management
```bash
# Create migration
make migrate-create

# Apply migrations
export DATABASE_URL="your_connection_string"
make migrate-up

# Generate sqlc after schema changes
make sqlc
```

## 🚀 Development Commands
```bash
# Development
make run              # Start server
make build            # Build binary
make test             # Run tests
make fmt              # Format code

# Database
make migrate-up       # Apply migrations
make sqlc            # Generate sqlc code
make swagger         # Generate API docs
```

## 📋 Code Conventions
- **Handlers**: `GetUser`, `CreateUser`, `ListUsers`
- **Services**: `UserService`, `OrderService`
- **SQL queries**: `GetUserByID`, `CreateUser`, `ListUsers`
- **Files**: `user_service.go`, `order_handler.go`

## 🎯 Key Principles
1. **Services own business logic** - Keep handlers thin
2. **Use sqlc directly** - No repository abstraction
3. **Environment-driven config** - No hardcoded values
4. **Module-based organization** - Self-contained domains

## 🚫 What We DON'T Use
- NO Repository Pattern - Services use sqlc directly
- NO ORM - Raw SQL with sqlc for type safety
- NO complex abstractions - Keep it simple